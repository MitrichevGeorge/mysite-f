{% extends "base.html" %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='reg-log.css') }}">
<div class="form-container">
    <div class="card">
        <div class="card2">
            <form class="form" id="register-form" method="POST">
                <p id="heading" style="font-size: 2rem;">Регистрация</p>
                <div class="field">
                    <svg class="input-icon" width="30" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M5 20V19C5 16.2386 7.23858 14 10 14H14C16.7614 14 19 16.2386 19 19V20M16 7C16 9.20914 14.2091 11 12 11C9.79086 11 8 9.20914 8 7C8 4.79086 9.79086 3 12 3C14.2091 3 16 4.79086 16 7Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <input type="text" class="input-field" placeholder="Имя пользователя" name="username" required autocomplete="off" />
                </div>
                <div class="field">
                    <svg class="input-icon" width="30" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="4" y="4" width="16" height="16" rx="3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        <path d="M4 14H9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M15 14H20" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M14.8191 14.0261C14.6079 14.6063 14.2228 15.1072 13.7164 15.4605C13.21 15.8137 12.607 16.0021 11.9895 16C11.3721 15.9978 10.7703 15.8052 10.2664 15.4484C9.76251 15.0916 9.38095 14.588 9.17383 14.0064" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <input type="email" class="input-field" placeholder="Email" name="email" required autocomplete="off" />
                </div>
                <div class="field">
                    <svg class="input-icon" width="30" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M16 9V6C16 4.34315 14.6569 3 13 3H11C9.34315 3 8 4.34315 8 6V9M16 9H8M16 9C17.6569 9 19 10.3431 19 12V18C19 19.6569 17.6569 21 16 21H8C6.34315 21 5 19.6569 5 18V12C5 10.3431 6.34315 9 8 9M12 14V17M13 14C13 14.5523 12.5523 15 12 15C11.4477 15 11 14.5523 11 14C11 13.4477 11.4477 13 12 13C12.5523 13 13 13.4477 13 14Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <input type="password" class="input-field with-toggle" placeholder="Пароль" name="password" required />
                    <svg class="password-toggle" onclick="togglePassword(this)" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M1 1l22 22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <div class="field">
                    <svg class="input-icon" width="30" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M14 6V5C14 3.89543 13.1046 3 12 3C10.8954 3 10 3.89543 10 5V6M9 11H15C15.5523 11 16 10.5523 16 10V7C16 6.44772 15.5523 6 15 6H9C8.44772 6 8 6.44772 8 7V10C8 10.5523 8.44772 11 9 11ZM5 21H19C20.1046 21 21 20.1046 21 19V16C21 14.8954 20.1046 14 19 14H5C3.89543 14 3 14.8954 3 16V19C3 20.1046 3.89543 21 5 21Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <circle cx="7.5" cy="17.5" r="1.5" fill="currentColor"/>
                        <circle cx="12" cy="17.5" r="1.5" fill="currentColor"/>
                        <circle cx="16.5" cy="17.5" r="1.5" fill="currentColor"/>
                    </svg>
                    <input type="password" class="input-field with-toggle" placeholder="Подтвердите пароль" name="confirm_password" required />
                    <svg class="password-toggle" onclick="togglePassword(this)" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M1 1l22 22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <div class="btn">
                    <button class="button1" type="submit"><div class="intext">Зарегистрироваться</div><span class="button1-shadow"></span></button>
                </div>
                <p class="btext">Уже есть аккаунт? <a href="{{ url_for('auth.login') }}">Войти</a></p>
            </form>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        $('#register-form').on('submit', function(e) {
            e.preventDefault();
            showNotification('info', 'Запрос отправлен, ждем ответа...');
            $.ajax({
                url: '{{ url_for("auth.register") }}',
                type: 'POST',
                data: $(this).serialize(),
                success: function(response) {
                    if (response.status === 'success') {
                        showNotification('success', response.message);
                        setTimeout(() => window.location.href = '{{ url_for("auth.login") }}', 3000);
                    } else {
                        showNotification('error', response.message);
                    }
                }
            }).fail(function(jqXHR) {
                const errorMessage = jqXHR.responseJSON ? jqXHR.responseJSON.message : 'Ошибка сервера. Попробуйте снова.';
                showNotification('error', errorMessage);
            });
        });
    });

    function showNotification(type, message) {
        const colors = {
            success: '#00ff75',
            error: '#ff3333',
            info: '#1a73e8'
        };
        const notification = $(`
            <div class="notification" style="background-color: ${colors[type]}; position: fixed; top: 20px; right: 20px; padding: 15px; color: white; border-radius: 5px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); z-index: 1000;">
                <span>${message}</span>
                <span class="close-btn" style="margin-left: 15px; cursor: pointer;">✖</span>
                <div class="progress-bar" style="position: absolute; bottom: 0; left: 0; height: 5px; background-color: rgba(255,255,255,0.8); width: 100%; animation: shrink 5s linear forwards;"></div>
            </div>
        `);
        $('body').append(notification);
        setTimeout(() => notification.remove(), 5000);
        notification.find('.close-btn').on('click', () => notification.remove());
    }
</script>
<style>
    @keyframes shrink {
        from { width: 100%; }
        to { width: 0%; }
    }
</style>
<script>
    document.addEventListener('mousemove', (e) => {
        document.body.style.setProperty('--mouse-x', `${e.clientX}px`);
        document.body.style.setProperty('--mouse-y', `${e.clientY}px`);
    });

    const button = document.querySelector('.button1');
    if (button) {
        let styleSheet = document.createElement('style');
        document.head.appendChild(styleSheet);
        let spotlightRuleIndex;
        let shadowRuleIndex;
        let entryEdge = null;

        button.addEventListener('mouseenter', (e) => {
            const rect = button.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            // Определяем, с какого края вошел курсор
            const fromLeft = x < rect.width / 2 && x <= 10;
            const fromRight = x > rect.width / 2 && x >= rect.width - 10;
            const fromTop = y < rect.height / 2 && y <= 10;
            const fromBottom = y > rect.height / 2 && y >= rect.height - 10;

            if (fromLeft) entryEdge = 'left';
            else if (fromRight) entryEdge = 'right';
            else if (fromTop) entryEdge = 'top';
            else if (fromBottom) entryEdge = 'bottom';
        });

        button.addEventListener('mousemove', (e) => {
            const rect = button.getBoundingClientRect();
            const spotlightSize = 30;
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            // Обновляем "лучик"
            if (!styleSheet.sheet.cssRules.length || !spotlightRuleIndex) {
                spotlightRuleIndex = styleSheet.sheet.insertRule(
                    `.button1::after { left: ${x}px; top: ${y}px; opacity: 0.8; }`,
                    0
                );
            } else {
                styleSheet.sheet.deleteRule(spotlightRuleIndex);
                spotlightRuleIndex = styleSheet.sheet.insertRule(
                    `.button1::after { left: ${x}px; top: ${y}px; opacity: 0.8; }`,
                    0
                );
            }

            // Обновляем вторую тень
            let shadowX, shadowY;
            const shadowSize = 50;
            if (entryEdge === 'left') {
                shadowX = -shadowSize;
                shadowY = y;
            } else if (entryEdge === 'right') {
                shadowX = rect.width;
                shadowY = y;
            } else if (entryEdge === 'top') {
                shadowX = x;
                shadowY = -shadowSize;
            } else if (entryEdge === 'bottom') {
                shadowX = x;
                shadowY = rect.height;
            }

            if (shadowRuleIndex !== undefined) {
                styleSheet.sheet.deleteRule(shadowRuleIndex);
            }
            shadowRuleIndex = styleSheet.sheet.insertRule(
                `.button1-shadow { left: ${shadowX}px; top: ${shadowY}px; opacity: 0.5; }`,
                spotlightRuleIndex + 1
            );
        });

        button.addEventListener('mouseleave', () => {
            // Скрываем "лучик"
            if (styleSheet.sheet.cssRules.length && spotlightRuleIndex !== undefined) {
                styleSheet.sheet.deleteRule(spotlightRuleIndex);
                spotlightRuleIndex = styleSheet.sheet.insertRule(
                    `.button1::after { opacity: 0; }`,
                    0
                );
            }

            // Скрываем вторую тень
            if (shadowRuleIndex !== undefined) {
                styleSheet.sheet.deleteRule(shadowRuleIndex);
                shadowRuleIndex = undefined;
            }
            entryEdge = null;
        });
    }
</script>
<script>
    if (button) {
         button.addEventListener('mousemove', (e) => {
             const rect = button.getBoundingClientRect();
             const x = e.clientX - rect.left;
             const y = e.clientY - rect.top;
             const centerX = rect.width / 2;
             const centerY = rect.height / 2;
 
             const shadowX = (x - centerX) / 3; // Сдвиг по X чуть менее интенсивный
             const shadowY = (y - centerY) / 1; // Сдвиг по Y максимально интенсивный
             const blur = 20 + Math.sqrt(Math.pow(x - centerX, 2) + Math.pow(y - centerY, 2)) / 10;
 
             // Устанавливаем box-shadow с двумя слоями
             button.style.boxShadow = `
                 0 5px 15px rgba(0, 255, 117, 0.4), /* Первая статичная тень */
                 ${shadowX}px ${shadowY}px ${blur}px rgba(55, 0, 255, 0.5) /* Вторая динамическая тень */
             `;
         });
 
         button.addEventListener('mouseleave', () => {
             button.style.boxShadow = '0 5px 15px rgba(0, 255, 117, 0.4)';
         });
     }
</script>
<script>
    function togglePassword(icon) {
        const input = icon.previousElementSibling;
        const isPassword = input.type === 'password';
        input.type = isPassword ? 'text' : 'password';
        icon.innerHTML = isPassword
            ? `<path d="M1 12C1 12 5 4 12 4C19 4 23 12 23 12C23 12 19 20 12 20C5 20 1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
               <path d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>`
            : `<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
               <path d="M1 1l22 22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>`;
    }
    </script>
{% endblock %}