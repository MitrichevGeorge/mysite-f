<!-- templates/profile.html -->
{% extends "base.html" %}
{% block content %}
    <link rel="stylesheet" href="{{ url_for('static', filename='profile/profile_styles.css') }}">
    <script src="{{ url_for('static', filename='profile/profile_scripts.js') }}"></script>
    <script>
        const dailyRequests = {{ daily_requests|tojson }};
        const yearStartOffset = 2;
        const isDarkTheme = {{ is_dark_theme|tojson }};
    </script>

    <div class="container">
        <div class="profile-card">
            <h1 class="profile-title">Профиль пользователя</h1>
            <div class="profile-info">
                <div class="info-item">
                    <span class="info-label">Имя пользователя:</span>
                    <span class="info-value">{{ current_user.username }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Email:</span>
                    <span class="info-value">{{ current_user.email }}</span>
                </div>
            </div>

            <div class="activity-section">
                <h2 class="activity-title">Активность</h2>
                <div class="calendar">
                    <table>
                        <tr>
                            <td></td>
                            <td>
                                <div class="months">
                                    <span>Янв</span>
                                    <span>Фев</span>
                                    <span>Мар</span>
                                    <span>Апр</span>
                                    <span>Май</span>
                                    <span>Июн</span>
                                    <span>Июл</span>
                                    <span>Авг</span>
                                    <span>Сен</span>
                                    <span>Окт</span>
                                    <span>Ноя</span>
                                    <span>Дек</span>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="days">
                                    <span class="dupr">Пн</span>
                                    <span class="ddwn">Вс</span>
                                </div>
                            </td>
                            <td>
                                <div class="grid" id="heatmap"></div>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <div class="settings-section">
            <h2 class="settings-title">Настройки</h2>
            <div class="settings-item buttons">
                <button id="change-username-btn" class="settings-btn">Сменить имя пользователя</button>
                <button id="change-password-btn" class="settings-btn">Сменить пароль</button>
            </div>
            <div class="settings-item">
                <label for="theme-toggle">Тема:</label>
                <select id="theme-toggle">
                    <option value="light" {% if current_user.theme == 'light' %}selected{% endif %}>Светлая</option>
                    <option value="dark" {% if current_user.theme == 'dark' %}selected{% endif %}>Тёмная</option>
                </select>
            </div>
        </div>

        <div class="tasks-section">
            <h2 class="settings-title">Мои задачи</h2>
            {% if current_user.is_creator %}
                <a href="{{ url_for('tasks.create_task') }}" class="settings-btn">Создать новую задачу</a>
                {% if my_tasks %}
                    {% for task in my_tasks %}
                        <div class="task-entry">
                            <span>{{ task.title }}</span>
                            <div class="task-actions">
                                <a href="{{ url_for('tasks.task', task_name=task.name) }}" class="settings-btn">Решить</a>
                                <a href="{{ url_for('tasks.edit_task', task_name=task.name) }}" class="settings-btn">Редактировать</a>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p>У вас пока нет созданных задач.</p>
                {% endif %}
            {% else %}
                <p>Вы не являетесь создателем. Вы можете попросить у администраторов сделать Вас создателем.</p>
            {% endif %}
        </div>

        <div class="tabsq">
            <div class="tab-list">
                <button class="tab-button active" onclick="showTab('history')">История заходов</button>
                <button class="tab-button" onclick="showTab('submissions')">Посылки</button>
            </div>

            <div id="history-tab" class="tab-content">
                {% for entry in current_user.login_history %}
                <div class="login-entry">
                    <span class="login-timestamp">{{ entry.timestamp }}</span>
                    <a href="{{ entry.url }}" class="login-url" target="_blank" rel="noopener noreferrer">
                        {{ entry.url }}
                    </a>
                </div>
                {% endfor %}
                <p class="ps">Тут написано только 100 последних заходов, так что не пугайтесь, если старые заходы будут исчезать. Всё-таки диск сервера не бесконечен.</p>
            </div>

            <div id="submissions-tab" class="tab-content" style="display: none;">
                <div id="submissions-list">
                    <!-- JS generated go here -->
                </div>
            </div>
        </div>
    </div>
{% endblock %}